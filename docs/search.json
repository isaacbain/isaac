[
  {
    "objectID": "blog.html",
    "href": "blog.html",
    "title": "Blog",
    "section": "",
    "text": "Koordinates API for R\n\n\n\n\n\n\ncode\n\n\nclimate\n\n\nanimation\n\n\n\n\n\n\n\n\n\nJun 18, 2024\n\n\nIsaac Bain\n\n\n\n\n\n\n\n\n\n\n\n\nEarthquakes animation\n\n\n\n\n\n\ncode\n\n\ngeophysics\n\n\nmaps\n\n\nanimation\n\n\n\n\n\n\n\n\n\nJun 10, 2024\n\n\nIsaac Bain\n\n\n\n\n\n\n\n\n\n\n\n\nLakes small multiples\n\n\n\n\n\n\ncode\n\n\nwater quality\n\n\nmaps\n\n\n\n\n\n\n\n\n\nJun 6, 2024\n\n\nIsaac Bain\n\n\n\n\n\n\n\n\n\n\n\n\nArrowtown air quality\n\n\n\n\n\n\ncode\n\n\nair quality\n\n\nanimation\n\n\n\n\n\n\n\n\n\nJun 2, 2024\n\n\nIsaac Bain\n\n\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "index.html#welcome-to-my-personal-website.",
    "href": "index.html#welcome-to-my-personal-website.",
    "title": "Kia ora üëã",
    "section": "Welcome to my personal website.",
    "text": "Welcome to my personal website.\nThis is where I share my projects, maps, graphs, and code that I‚Äôve been tinkering with. You‚Äôll hopefully some interesting content here about environmental data, freshwater ecology, and public health.\nPlease remember, nothing here represents the views of my employer‚Äîit‚Äôs all just my personal work and thoughts. My goal is to make complex data more accessible and even a bit fun. I aim to provide insights and provoke thought rather than deliver definitive conclusions.\nI hope you find something intriguing and valuable on my site. Feel free to reach out with any questions or comments.\nNgƒÅ mihi,\nIsaac Bain"
  },
  {
    "objectID": "posts/lakes-small-multiples/index.html",
    "href": "posts/lakes-small-multiples/index.html",
    "title": "Lakes small multiples",
    "section": "",
    "text": "I‚Äôve been inspired by a new type of small multiples map I‚Äôve seen, where multipolygons are extracted from their spatial locations and reassembled in a grid while maintaining their relative sizes. If you unsure what I mean, check out this one as an example. So I thought I‚Äôd try applying it to some lakes data in New Zealand."
  },
  {
    "objectID": "posts/lakes-small-multiples/index.html#libraries-and-import-data",
    "href": "posts/lakes-small-multiples/index.html#libraries-and-import-data",
    "title": "Lakes small multiples",
    "section": "1 Libraries and import data",
    "text": "1 Libraries and import data\nThe Department of Conservation‚Äôs Freshwater Ecosystems of New Zealand (FENZ) geodatabase provided the lake boundary polygons. While one could also source these from the LINZ topo map layers, the advantage of the FENZ layer is that it can be linked to other datasets, such as modelled water quality.\nThe Ministry for the Environment provides modelled lake water quality data for 3,813 lakes in New Zealand that are larger than 1 hectare. This data can be joined using the FENZ lake ID. The dataset is generated by a statistical learning model (specifically, a random forest model) trained on actual monitoring data and using a number of environmental predictors to extrapolate out to unmeasured lakes.\n\n\nShow the code\nlibrary(tidyverse)\nlibrary(sf)\nlibrary(gridExtra)\n\nlakes &lt;- st_read(\"data/fenz_v1_lakes/FENZ_v1_Lakes.shp\", quiet = TRUE) |&gt;\n  janitor::clean_names() |&gt; \n  drop_na(name)\n\nwq &lt;- read_csv(\"data/mfe-lake-water-quality-modelled-2016-2020-CSV/lake-water-quality-modelled-2016-2020.csv\") |&gt;\n  janitor::clean_names() |&gt; \n  filter(indicator == \"TLI3\")\n\nlakes &lt;- lakes |&gt; \n  left_join(wq, by = c(\"lid\" = \"lfenzid\"))"
  },
  {
    "objectID": "posts/lakes-small-multiples/index.html#what-are-the-largest-lakes-in-new-zealand",
    "href": "posts/lakes-small-multiples/index.html#what-are-the-largest-lakes-in-new-zealand",
    "title": "Lakes small multiples",
    "section": "2 What are the largest lakes in New Zealand?",
    "text": "2 What are the largest lakes in New Zealand?\nSorting the lakes dataset by size (surface area) and selecting the largest ones is a fairly straightforward task. Interestingly, there is a discrepancy between my data and this Wikipedia page listing the sizes of lakes in NZ. Wikipedia lists it as 141 km2, whereas my data shows it as 152 km2. Since the Wikipedia article does not list its sources, the origin of this discrepancy remains unclear!1\nI‚Äôve have also selected Trophic Level Index (TLI) as an indicator of water quality - more on that below.\n\n\nShow the code\nlakes_20 &lt;- lakes |&gt; \n  top_n(n = 20, wt = shape_area)\n\nmapview::mapview(lakes_20)\n\n\n\n\n\n\nShow the code\nlakes_20 |&gt; \n  st_drop_geometry() |&gt; \n  select(name, shape_area, value) |&gt; \n  arrange(desc(shape_area)) |&gt; \n  mutate(shape_area = shape_area / 1e6) |&gt; \n  rename(Name = name,\n         `Lake area (km2)` = shape_area,\n         TLI3 = value) |&gt; \n  knitr::kable(digits = 1)\n\n\n\n\n\nName\nLake area (km2)\nTLI3\n\n\n\n\nLake Taupo (Taupomoana)\n613.3\n2.6\n\n\nLake Te Anau\n344.2\n1.6\n\n\nLake Wakatipu\n299.0\n1.5\n\n\nLake Wanaka\n204.3\n1.7\n\n\nLake Ellesmere (Te Waihora)\n197.7\n6.0\n\n\nLake Pukaki\n172.8\n1.7\n\n\nLake Hawea\n152.0\n1.4\n\n\nLake Manapouri\n142.3\n1.7\n\n\nLake Tekapo\n96.6\n1.6\n\n\nLake Rotorua\n80.6\n4.2\n\n\nLake Wairarapa\n77.4\n4.6\n\n\nLake Benmore\n75.9\n1.9\n\n\nLake Hauroko\n72.2\n2.6\n\n\nLake Ohau\n59.3\n1.7\n\n\nLake Waikaremoana\n50.0\n2.8\n\n\nLake Poteriteri\n44.4\n3.0\n\n\nLake Tarawera\n41.2\n3.1\n\n\nLake Brunner (Moana)\n40.6\n2.9\n\n\nLake Coleridge\n36.9\n2.1\n\n\nLake Waikare\n34.4\n6.3\n\n\n\n\n\nThere‚Äôs an interesting pattern regarding lake size and water quality. None of the lakes with very low values of TLI3 (e.g &lt;2) are small. This could just be an artifact of the modelled data, perhaps a relationship that the model has learned incorrectly due to a strong bias in the training data. It would be better to using monitoring data here to confirm this relationship.\n\n\nShow the code\nlakes |&gt; \n  st_drop_geometry() |&gt; \n  select(name, shape_area, value) |&gt; \n  mutate(shape_area = shape_area / 1e6) |&gt; \n  ggplot(aes(value, shape_area)) +\n  geom_point() +\n  geom_smooth() +\n  labs(x = \"TLI3 score\", y = \"Lake area (km2)\") +\n  theme_minimal()"
  },
  {
    "objectID": "posts/lakes-small-multiples/index.html#plot-the-20-largest-lakes",
    "href": "posts/lakes-small-multiples/index.html#plot-the-20-largest-lakes",
    "title": "Lakes small multiples",
    "section": "3 Plot the 20 largest lakes",
    "text": "3 Plot the 20 largest lakes\nNow, let‚Äôs get down to plotting the largest lakes, and colour them by their respective TLI3 score. LAWA provides a good fact sheet on what this metric means. In short:\n\nThe Trophic Level Index (TLI) is a method of characterising the ecological health of lakes based on the amount of nutrients and algae growing in them. It provides an integrated measure of water quality that can be tracked over time and that can be used to estimate biological productivity. It is presented as a score, the lower the score the better the condition of the lake.\n\nHere‚Äôs what the scores correspond to in ecological terms:\n\n\n\n\n\n\n\nTLI Score\nDescription\n\n\n\n\n0‚Äì2\nMicrotrophic: The lake is very clean with very low levels of nutrients and algae. The lake can have snow or glacial sources.\n\n\n&gt;2‚Äì3\nOligotrophic: The lake is clear and blue, with low levels of nutrients and algae.\n\n\n&gt;3‚Äì4\nMesotrophic: The lake has moderate levels of nutrients and algae.\n\n\n&gt;4‚Äì5\nEutrophic: The lake is murky, with high amounts of nutrients and algae.\n\n\n&gt;5\nSupertrophic: The lake has very high amounts of phosphorus and nitrogen, and can be overly fertile and often associated with poor water clarity. Excessive algae growth can occur. Suitability for recreational purposes is often poor.\n\n\n\n\n\nShow the code\n# Calculate centroids\nlake_polygons &lt;- lakes_20 %&gt;%\n  mutate(centroid = st_centroid(st_geometry(.)))\n\n# Sort the lake polygons by shape_area in descending order\nlake_polygons &lt;- lake_polygons %&gt;%\n  arrange(desc(shape_area))\n\n# Compute bounding boxes and find the maximum width and height\nbboxes &lt;- lapply(st_geometry(lake_polygons), function(x) as.numeric(st_bbox(x)))\nmax_width &lt;- max(sapply(bboxes, function(x) abs(x[1] - x[3])))\nmax_height &lt;- max(sapply(bboxes, function(x) abs(x[2] - x[4])))\n\n# Set padding to ensure polygons are not cut off\npadding &lt;- 3500  # Adjust this value based on your specific spatial scale\n\n# Calculate colors based on value\nlake_polygons$color &lt;- viridis::viridis(\n  n = nrow(lake_polygons), \n  option = \"D\", \n  direction = 1\n)[cut(lake_polygons$value, breaks = nrow(lake_polygons), labels = FALSE)]\n\n# Function to make plots\ngraph &lt;- function(x) {\n  centroid &lt;- st_coordinates(lake_polygons$centroid[x])\n  ggplot(lake_polygons[x, ]) +\n    geom_sf(fill = lake_polygons$color[x], colour = NA) +\n    coord_sf(xlim = c(centroid[1] - max_width/2 - padding, centroid[1] + max_width/2 + padding), \n             ylim = c(centroid[2] - max_height/2 - padding, centroid[2] + max_height/2 + padding), \n             expand = FALSE) +\n    theme_void() +\n    ggtitle(str_wrap(lake_polygons$name[x], width = 20)) +\n    theme(plot.title = element_text(hjust = 0.5, size = 10, vjust = 1),\n          legend.position = \"none\")\n}\n\n# Create a list of plots\nplot_list &lt;- lapply(1:nrow(lake_polygons), FUN = graph)\n\n# Combine plots and titles\ncombined_list &lt;- lapply(plot_list, function(p) {\n  title &lt;- ggplot_build(p)$layout$panel_params[[1]]$title\n  gridExtra::arrangeGrob(p, top = grid::textGrob(\n    label = title,\n    gp = grid::gpar(fontsize = 10),\n    hjust = 0.5,\n    vjust = 1\n  ))\n})\n\n# Create the overall title and subtitle grobs\noverall_title &lt;- grid::textGrob(\"The 20 Largest Lakes of New Zealand\", gp = grid::gpar(fontsize = 16, fontface = \"bold\"))\nsubtitle &lt;- grid::textGrob(\"Coloured by Trophic Level Index\", gp = grid::gpar(fontsize = 12))\n\n# Create a common legend plot to extract the legend\nlegend_plot &lt;- ggplot(lake_polygons) +\n  geom_sf(aes(fill = value), colour = NA) +\n  scale_fill_viridis_c(name = \"TLI3\", option = \"D\", direction = 1) +\n  theme_void() +\n  theme(\n    legend.position = \"bottom\",\n    legend.title = element_text(size = 10, hjust = 0.5),\n    legend.title.position = \"top\",\n    legend.text = element_text(size = 8),\n    legend.box.margin = margin(0, 0, 0, 0)\n  )\n\n# Extract the legend\nlegend_grob &lt;- cowplot::get_plot_component(legend_plot, 'guide-box-bottom', return_all = TRUE)\n\n# Arrange the plots together with the overall title and subtitle\nfinal_plot &lt;- gridExtra::grid.arrange(\n  gridExtra::arrangeGrob(overall_title, subtitle, ncol = 1, heights = c(0.08, 0.05)),\n  do.call(gridExtra::arrangeGrob, c(combined_list, ncol = 5)),\n  legend_grob,\n  nrow = 3,\n  heights = c(0.1, 0.8, 0.1)\n)"
  },
  {
    "objectID": "posts/lakes-small-multiples/index.html#plot-the-50-largest-lakes",
    "href": "posts/lakes-small-multiples/index.html#plot-the-50-largest-lakes",
    "title": "Lakes small multiples",
    "section": "4 Plot the 50 largest lakes",
    "text": "4 Plot the 50 largest lakes\nBonus just for the blog readers‚Ä¶ here‚Äôs the plot for the 50 largest lakes in New Zealand!"
  },
  {
    "objectID": "posts/lakes-small-multiples/index.html#next-steps",
    "href": "posts/lakes-small-multiples/index.html#next-steps",
    "title": "Lakes small multiples",
    "section": "5 Next steps",
    "text": "5 Next steps\n\nPlot the smallest 20 lakes\nMake an estuaries small multiples map\nFigure out how to shrink the rows for the smaller lakes"
  },
  {
    "objectID": "posts/lakes-small-multiples/index.html#footnotes",
    "href": "posts/lakes-small-multiples/index.html#footnotes",
    "title": "Lakes small multiples",
    "section": "Footnotes",
    "text": "Footnotes\n\n\nLakes380 lists it as 151.77 km2, Fish and Game as 124 km2, and Queenstown Lakes District Council as 149 km2.‚Ü©Ô∏é"
  },
  {
    "objectID": "posts/earthquakes-animation/index.html",
    "href": "posts/earthquakes-animation/index.html",
    "title": "Earthquakes animation",
    "section": "",
    "text": "GeoNet is a partnernship between Toka T≈´ Ake EQC, GNS Science, and Land Information New Zealand (LINZ) which has been around since 2001. It is a geological hazard monitoring system that uses a network of geophysical instruments to detect earthquakes, volcanic activity, large landslides, tsunami, and slow-slip events that precede large earthquakes.\nThey make their data available in a number of API formats. Here, I use a Web Feature Service (WFS) to query the GeoNet Earthquake Catalogue for earthquakes that happened (1) last year, (2) were greater than magnitude one, (3) occurred in or near New Zealand.\nThe API bypasses the CSV download limit on their website, and the data can be directly read into R as a Simple Features (sf) spatial object.\nLibraries\n\n\nShow the code\nlibrary(tidyverse)\nlibrary(sf)\nlibrary(httr)\nlibrary(gganimate)\nlibrary(patchwork)\nlibrary(ggtext)\n\n\nDownload data\n\n\nShow the code\nwfs_url &lt;- \"https://wfs.geonet.org.nz/geonet/ows\"\ntype_name &lt;- \"geonet:quake_search_v1\"\noutput_format &lt;- \"json\"\ncql_filter &lt;- \"origintime&gt;='2023-01-01T00:00:00.000Z' AND origintime&lt;'2024-01-01T00:00:00.000Z' AND magnitude&gt;1.5\"\n\nquery_url &lt;- paste0(\n  wfs_url,\n  \"?service=WFS&version=1.0.0&request=GetFeature&typeName=\", type_name,\n  \"&outputFormat=\", output_format,\n  \"&cql_filter=\", URLencode(cql_filter)\n)\n\nearthquakes_sf &lt;- st_read(query_url) |&gt; st_transform(2193)\n\ncoastline &lt;- st_read(\"data/coastline_simplified/nz-coastlines-and-islands-polygons-topo-150k.shp\", crs = 2193)\n\n\nCrop data\n\n\nShow the code\nbbox &lt;- st_as_sfc(st_bbox(c(xmin = 166, ymin = -47.5, xmax = 180, ymax = -33))) |&gt;\n  st_set_crs(4326) |&gt;\n  st_transform(2193)\n\nearthquakes_nz_sf &lt;- st_intersection(earthquakes_sf, bbox)\n\ncoastline &lt;- st_crop(coastline, bbox)"
  },
  {
    "objectID": "posts/earthquakes-animation/index.html#data-source",
    "href": "posts/earthquakes-animation/index.html#data-source",
    "title": "Earthquakes animation",
    "section": "",
    "text": "GeoNet is a partnernship between Toka T≈´ Ake EQC, GNS Science, and Land Information New Zealand (LINZ) which has been around since 2001. It is a geological hazard monitoring system that uses a network of geophysical instruments to detect earthquakes, volcanic activity, large landslides, tsunami, and slow-slip events that precede large earthquakes.\nThey make their data available in a number of API formats. Here, I use a Web Feature Service (WFS) to query the GeoNet Earthquake Catalogue for earthquakes that happened (1) last year, (2) were greater than magnitude one, (3) occurred in or near New Zealand.\nThe API bypasses the CSV download limit on their website, and the data can be directly read into R as a Simple Features (sf) spatial object.\nLibraries\n\n\nShow the code\nlibrary(tidyverse)\nlibrary(sf)\nlibrary(httr)\nlibrary(gganimate)\nlibrary(patchwork)\nlibrary(ggtext)\n\n\nDownload data\n\n\nShow the code\nwfs_url &lt;- \"https://wfs.geonet.org.nz/geonet/ows\"\ntype_name &lt;- \"geonet:quake_search_v1\"\noutput_format &lt;- \"json\"\ncql_filter &lt;- \"origintime&gt;='2023-01-01T00:00:00.000Z' AND origintime&lt;'2024-01-01T00:00:00.000Z' AND magnitude&gt;1.5\"\n\nquery_url &lt;- paste0(\n  wfs_url,\n  \"?service=WFS&version=1.0.0&request=GetFeature&typeName=\", type_name,\n  \"&outputFormat=\", output_format,\n  \"&cql_filter=\", URLencode(cql_filter)\n)\n\nearthquakes_sf &lt;- st_read(query_url) |&gt; st_transform(2193)\n\ncoastline &lt;- st_read(\"data/coastline_simplified/nz-coastlines-and-islands-polygons-topo-150k.shp\", crs = 2193)\n\n\nCrop data\n\n\nShow the code\nbbox &lt;- st_as_sfc(st_bbox(c(xmin = 166, ymin = -47.5, xmax = 180, ymax = -33))) |&gt;\n  st_set_crs(4326) |&gt;\n  st_transform(2193)\n\nearthquakes_nz_sf &lt;- st_intersection(earthquakes_sf, bbox)\n\ncoastline &lt;- st_crop(coastline, bbox)"
  },
  {
    "objectID": "posts/earthquakes-animation/index.html#exploratory-data-analysis",
    "href": "posts/earthquakes-animation/index.html#exploratory-data-analysis",
    "title": "Earthquakes animation",
    "section": "2 Exploratory data analysis",
    "text": "2 Exploratory data analysis\n\n2.1 Depth and magnitude\nFirstly, let‚Äôs examine the distribution of earthquake depths and magnitudes (Figure¬†1). It‚Äôs evident that there are more shallow earthquakes than deep ones, and more small earthquakes than large ones.\n\n\nShow the code\nplot_depth &lt;- ggplot(earthquakes_nz_sf, aes(x = depth)) +\n  geom_histogram(aes(fill = ..x..), bins = 30, color = \"black\", alpha = 0.7) +\n  theme_minimal() +\n  labs(\n    title = \"Distribution of Depths\",\n    x = \"Depth (km)\",\n    y = \"Count\"\n  ) +\n  scale_fill_viridis_c(option = \"inferno\", direction = -1) +\n  theme(\n    axis.text.x = element_text(vjust = 0.5, hjust = 0.5),\n    legend.position = \"bottom\",\n    legend.title = element_blank()\n  )\n\nbin_data &lt;- earthquakes_nz_sf %&gt;%\n  mutate(bin = cut(magnitude, breaks = seq(min(magnitude), max(magnitude), length.out = 31), include.lowest = TRUE)) %&gt;%\n  group_by(bin) %&gt;%\n  summarise(\n    magnitude = mean(magnitude),\n    count = n(),\n    magnitude_exp = mean(exp(magnitude))\n  )\n\nplot_magnitude &lt;- ggplot(earthquakes_nz_sf, aes(x = magnitude)) +\n  geom_histogram(aes(y = ..count..), bins = 30, fill = \"darkslateblue\", color = \"black\", alpha = 0.7) +\n  # geom_point(data = bin_data, aes(x = magnitude, y = count, size = magnitude_exp),\n  #            color = \"black\", alpha = 0.5) +\n  theme_minimal() +\n  labs(\n    title = \"Distribution of Magnitudes\",\n    x = \"Magnitude\",\n    y = \"Count\"\n  ) +\n  scale_x_continuous(\n    breaks = c(1, 2, 3, 4, 5, 6, 7),\n    labels = c(\"1\\nUnnoticeable\", \"2\\nUnnoticeable\", \"3\\nWeak\", \"4\\nLight\", \"5\\nModerate\", \"6\\nStrong\", \"7\\nSevere\")\n  ) +\n  scale_size_continuous(\n    name = \"Magnitude\",\n    range = c(3, 15),\n    breaks = exp(c(3, 4, 5, 6)),\n    labels = c(\"‚â§ 3\", 4, 5, \"‚â• 6\")\n  ) +\n  theme(\n    axis.text.x = element_text(vjust = 0.5, hjust = 0.5),\n    legend.position = \"bottom\",\n    legend.title = element_blank()\n  )\n\nplot_depth + plot_magnitude\n\n\n\n\n\n\n\n\nFigure¬†1: Distribution of depths and magnitudes of earthquakes in New Zealand, 2023.\n\n\n\n\n\n\n\n2.2 Depth vs magnitude\nLet‚Äôs take this one step further and examine the relationship between depth and magnitude (Figure¬†2). Large, shallow earthquakes are the most dangerous, causing significant damage. Whilst, small, deep earthquakes are less likely to be felt by people, and there are few of these in the dataset‚Äîpossibly because they are harder for seismometers to detect.\n\n\nShow the code\nggplot(data = earthquakes_nz_sf, aes(magnitude, depth)) +\n    geom_point(aes(color = depth &gt; 35), alpha = 0.1) +\n  scale_color_manual(values = c(\"TRUE\" = \"darkorange\", \"FALSE\" = \"darkslateblue\")) +\n  geom_hline(yintercept = 35, linetype = \"dashed\") +\n  theme_minimal() +\n  labs(\n    x = \"Magnitude\",\n    y = \"Depth (km)\",\n    title = \"Earthquake depth versus magnitude\",\n    subtitle = \"Dashed line at 35 km depth boundary between &lt;span style='color:darkslateblue;'&gt;&lt;b&gt;crustal&lt;/b&gt;&lt;/span&gt; and &lt;span style='color:darkorange;'&gt;&lt;b&gt;subduction&lt;/b&gt;&lt;/span&gt; earthquakes\"\n  ) +\n  annotate(\n    geom = \"curve\", x = 5.5, y = 200, xend = 5.9, yend = 50,\n    curvature = .3, arrow = arrow(length = unit(2, \"mm\"))\n  ) +\n  annotate(geom = \"text\", x = 5.5, y = 215, label = \"Shallow & strong!\", hjust = \"center\") +\n  annotate(\n    geom = \"curve\", x = 1.75, y = 450, xend = 1.75, yend = 500,\n    curvature = .3, arrow = arrow(length = unit(2, \"mm\"))\n  ) +\n  annotate(geom = \"text\", x = 1.75, y = 440, label = \"No worries\", hjust = \"center\") +\n  annotate(geom = \"text\", x = 6.5, y = 50, label = \"35km\", hjust = \"center\") +\n  theme(\n    legend.position = \"none\",\n    plot.subtitle = ggtext::element_markdown()\n  )\n\n\n\n\n\n\n\n\nFigure¬†2: Earthquake depth versus magnitude in New Zealand, 2023. Dashed line at 35 km depth boundary between crustal and subduction earthquakes."
  },
  {
    "objectID": "posts/earthquakes-animation/index.html#mapping",
    "href": "posts/earthquakes-animation/index.html#mapping",
    "title": "Earthquakes animation",
    "section": "3 Mapping",
    "text": "3 Mapping\n\n3.1 Crustal vs subduction earthquakes\nDeep earthquakes under the North Island form a well-defined line, representing the Hikurangi subduction zone where the Pacific Plate is being forced under the Australian Plate (Figure¬†3). This pattern, with deeper earthquakes towards the west of the North Island, is the Wadati‚ÄìBenioff zone.\nIn contrast, the South Island exhibits a different earthquake pattern, with the Australian Plate being forced under the Pacific Plate. This is the Alpine Fault, a transform fault responsible for the Southern Alps. The deeper earthquakes occur on the southeast edge of the Wadati‚ÄìBenioff zone, where it dips steeply to the southeast.\n\n\nShow the code\n# https://www.otago.ac.nz/geology/research/alpine-fault\n\nplot_crustal &lt;- ggplot() +\n  geom_sf(\n    data = coastline,\n    fill = \"#839073\",\n    color = NA\n  ) +\n  geom_sf(\n    data = earthquakes_nz_sf |&gt; filter(depth &lt; 35),\n    colour = \"darkslateblue\",\n    size = 0.1,\n    alpha = 0.7\n  ) +\n  coord_sf(xlim = c(1050000, 2200000), ylim = c(4700000, 6200000)) +\n  theme_void() +\n  labs(\n    title = \"&lt;span style='color:darkslateblue'&gt;Crustal&lt;/span&gt; earthquakes &lt;br&gt;&lt; 35km deep\",\n    x = \"\",\n    y = \"\"\n  ) +\n  theme(plot.title = element_markdown(\n    family = \"sans\", size = 12, face = \"bold\", color = \"#394053\", hjust = 0.5\n  )) +\n    annotate(\n    \"curve\", x = 1680000, y = 5746015, xend = 1851604, yend = 5703141,\n    curvature = .3, arrow = arrow(length = unit(2, \"mm\")), color = \"black\",\n    linewidth = 0.25\n  ) +\n  annotate(\n    \"text\", x = 1670000, y = 5746015, label = \"Taup≈ç volcanic zone\", hjust = \"right\", color = \"black\", size = 2.5\n  ) +\n    annotate(\n    \"curve\", x = 1894962, y = 6057348, xend = 1969587, yend = 5839512,\n    curvature = .3, arrow = arrow(length = unit(2, \"mm\")), color = \"black\",\n    linewidth = 0.25\n  ) +\n  annotate(\n    \"text\", x = 1894962, y = 6057348, label = \"Whakaari \\nWhite Island\", hjust = \"centre\",\n    vjust = -0.15, color = \"black\", size = 2.5\n  )\n\nplot_subduction &lt;- ggplot() +\n  geom_sf(\n    data = coastline,\n    fill = \"#839073\",\n    color = NA\n  ) +\n  geom_sf(\n    data = earthquakes_nz_sf |&gt; filter(depth &gt; 35),\n    aes(color = depth),\n    size = 0.1,\n    alpha = 0.7\n  ) +\n  coord_sf(xlim = c(1050000, 2200000), ylim = c(4700000, 6200000)) +\n  theme_void() +\n  labs(\n    title = \"&lt;span style='color:darkorange'&gt;Subduction&lt;/span&gt; earthquakes &lt;br&gt;&gt; 35km deep\",\n    x = \"\",\n    y = \"\",\n    color = \"Depth (km)\",\n    size = \"Magnitude\"\n  ) +\n  theme(\n    plot.title = element_markdown(\n      family = \"sans\", size = 12, face = \"bold\", color = \"#394053\", hjust = 0.5\n    ),\n    legend.position = \"bottom\"\n  ) +\n  scale_color_viridis_c(option = \"inferno\", direction = -1) +\n    annotate(\n    \"curve\", x = 1680000, y = 5000000, xend = 1450000, yend = 5200000,\n    curvature = .3, arrow = arrow(length = unit(2, \"mm\")), color = \"black\",\n    linewidth = 0.25\n  ) +\n  annotate(\n    \"text\", x = 1680000, y = 4930000, label = \"Notable gap in deep \\nearthquakes\", hjust = 0.5, color = \"black\", size = 2.5\n  )\n\nplot_crustal + plot_subduction\n\n\n\n\n\n\n\n\nFigure¬†3: Crustal and subduction earthquakes in New Zealand, 2023. The Hikurangi subduction zone is visible under the North Island, and the Alpine Fault under the South Island.\n\n\n\n\n\n\n\n3.2 Static map\nLet‚Äôs plot all of the earthquakes on a map of New Zealand (Figure¬†4). We‚Äôll use the geom_sf function to plot the earthquakes and the coastline. Additionally we‚Äôll use the scale_size_continuous function to adjust the size of the points based on the magnitude of the earthquake, applying an exponential transformation to reflect the disproportionately larger amount of energy released by larger magnitude earthquakes.\n\n\nShow the code\nggplot() +\n  geom_sf(\n    data = coastline,\n    fill = \"#839073\",\n    color = NA\n  ) +\n  geom_sf(\n    data = earthquakes_nz_sf,\n    aes(color = depth, size = exp(magnitude)),\n    alpha = 0.2\n  ) +\n  scale_size_continuous(\n    name = \"Magnitude\",\n    range = c(0.01, 8),\n    breaks = exp(c(3, 4, 5, 6)),\n    labels = c(\"‚â§ 3\", 4, 5, \"‚â• 6\")\n  ) +\n  coord_sf(xlim = c(1050000, 2200000), ylim = c(4700000, 6200000)) +\n  theme_void() +\n  labs(\n    title = \"Earthquakes in New Zealand (2023)\",\n    x = \"\",\n    y = \"\",\n    color = \"Depth (km)\",\n    size = \"Magnitude\"\n  ) +\n  theme(plot.title = element_text(\n    family = \"sans\", size = 12, face = \"bold\", color = \"#394053\", hjust = 0.5, vjust = 2.5\n  )) +\n  scale_color_viridis_c(\n    option = \"inferno\",\n    direction = -1\n  )\n\n\n\n\n\n\n\n\nFigure¬†4: Earthquakes in New Zealand, 2023. The size of the points represents the magnitude of the earthquake, and the colour represents the depth.\n\n\n\n\n\n\n\n3.3 Animated plot\nNow, to make it animated! We‚Äôll use the gganimate package to create an animated plot of the earthquakes over time (Figure¬†5). We‚Äôll use the transition_time function to animate the plot over the origintime variable, which is the date of the earthquake. Additionally, we‚Äôll use the shadow_mark function to leave a shadow of the earthquakes that have already occurred.\n\n\nShow the code\np &lt;- ggplot() +\n  geom_sf(\n    data = coastline,\n    fill = \"#839073\",\n    color = NA\n  ) +\n  geom_sf(\n    data = earthquakes_nz_sf,\n    aes(color = depth, size = exp(magnitude)),\n    alpha = 0.4\n  ) +\n  scale_size_continuous(\n    name = \"Magnitude\",\n    range = c(0.01, 6), \n    breaks = exp(c(3, 4, 5, 6)),\n    labels = c(\"‚â§ 3\", 4, 5, \"‚â• 6\")\n  ) +\n  coord_sf(xlim = c(1050000, 2200000), ylim = c(4700000, 6200000)) +\n  theme_void() +\n  labs(\n    title = \"Earthquakes in New Zealand (2023)\",\n    subtitle = \"Date: {lubridate::as_date(next_state)}\",\n    x = \"\",\n    y = \"\",\n    color = \"Depth (km)\",\n    size = \"Magnitude\"\n  ) +\n  scale_color_viridis_c(\n    option = \"inferno\",\n    direction = -1\n  ) +\n  theme(\n    plot.title = element_text(family = \"sans\", size = 12, face = \"bold\", color = \"#394053\",\n                              hjust = 0.5),\n    plot.subtitle = element_text(size = 8, hjust = 0.5),\n    legend.title = element_text(size = 8)\n  ) +\n  guides(color = guide_colourbar(reverse = T)) +\n  transition_states(origintime, transition_length = 2, state_length = 1) +\n  shadow_mark(past = TRUE)\n\nanimate(p,\n  start_pause = 15,\n  end_pause = 60,\n  nframes = 300,\n  fps = 20,\n  res = 300,\n  renderer = gifski_renderer()\n)\n\n\n\n\n\n\n\n\nFigure¬†5: Animated plot of earthquakes in New Zealand, 2023. The size of the points represents the magnitude of the earthquake, and the colour represents the depth."
  },
  {
    "objectID": "posts/earthquakes-animation/index.html#conclusion",
    "href": "posts/earthquakes-animation/index.html#conclusion",
    "title": "Earthquakes animation",
    "section": "4 Conclusion",
    "text": "4 Conclusion\nSo that‚Äôs it! We‚Äôve explored the earthquakes in New Zealand in 2023, focusing on their distribution, the relationship between depth and magnitude, and the spatial patterns relative to tectonic plate boundaries. We‚Äôve created static and animated visualisations to enhance our understanding of the data and effectively communicate our findings.\nNext steps could include further analysis of the data, such as:\n\nClustering the earthquakes to identify regions of high seismic activity.\nExploring the relationship between earthquakes and other geophysical data, such as volcanic activity or fault lines.\nPlotting seismograms to visualise the seismic waves generated by particular earthquakes."
  },
  {
    "objectID": "posts/arrowtown-air-quality/index.html",
    "href": "posts/arrowtown-air-quality/index.html",
    "title": "Arrowtown air quality",
    "section": "",
    "text": "Most of the time, New Zealand enjoys good air quality, allowing us to step outside and breathe a breath of fresh air, knowing it‚Äôs safe. However at certain times and places, our air is polluted to such levels that it causes us harm, or in the worst cases, premature death. Here I access air quality data from LAWA and explore it for one site known for severe winter air pollution."
  },
  {
    "objectID": "posts/arrowtown-air-quality/index.html#libraries",
    "href": "posts/arrowtown-air-quality/index.html#libraries",
    "title": "Arrowtown air quality",
    "section": "1 Libraries",
    "text": "1 Libraries\n\n\nShow the code\nlibrary(tidyverse) # provides ggplot, dplyr, etc\nlibrary(janitor) # tidy up messy variable names\nlibrary(gganimate) # provides animations\nlibrary(geomtextpath) # makes labels curved on polar graph\nlibrary(leaflet) # for interactive mapping"
  },
  {
    "objectID": "posts/arrowtown-air-quality/index.html#import-data",
    "href": "posts/arrowtown-air-quality/index.html#import-data",
    "title": "Arrowtown air quality",
    "section": "2 Import data",
    "text": "2 Import data\nLand, Air, Water Aotearoa (LAWA) is a collaboration between New Zealand‚Äôs 16 regional councils and unitary authorities, the Cawthron Institute, the Ministry for the Environment, the Department of Conservation, and Stats NZ. LAWA provides state of the environment monitoring data for various environmental domains, including; swimming water quality, estuary health, groundwater quality, lake quality, land cover, river quality, water quantity, and of particular interest here, air quality.\nLAWA makes their data freely available at https://lawa.org.nz/download-data. From this source I downloaded an Excel sheet of air quality data for the period 2016 to 2022. Currently, the available parameters are PM10 and PM2.5.\nParticulate matter (PM) can have adverse effects on human health and the environment. The numbers 10 and 2.5 refer to the diameter of the particles in micrometers (¬µm).\n\n\n\n\n\n\nWhat are the human health impacts of PM in New Zealand?\n\n\n\n\n\nHales et al.¬†(2021) did a retrospective cohort epidemiological study of the association between PM2.5, NO2 and mortality and morbidity for 2.2m New Zealanders. They found that exposure to PM2.5 per 10 Œºg/m3 increased the risk of death by 11% (95% CI 7-15%) and increased the risk of ischaemic heart disease by 29% (95% CI 23-35%).\nHales, S., Atkinson, J., Metcalfe, J., Kuschel, G., & Woodward, A. (2021). Long term exposure to air pollution, mortality and morbidity in New Zealand: cohort study. Science of The Total Environment, 801, 149660.\n\n\n\n\n\nShow the code\ndat &lt;- readxl::read_xlsx(\"data/airqualitydownloaddata_2016-2022.xlsx\",\n                         sheet = \"Air Quality Data\") |&gt; # read in data\n  clean_names() |&gt; # tidy up messy names\n  mutate(year = year(sample_date)) |&gt; # extract year as a new variable\n  filter(!is.na(sample_date) & !is.na(concentration)) # filter out NAs"
  },
  {
    "objectID": "posts/arrowtown-air-quality/index.html#what-are-the-worst-sites",
    "href": "posts/arrowtown-air-quality/index.html#what-are-the-worst-sites",
    "title": "Arrowtown air quality",
    "section": "3 What are the worst sites?",
    "text": "3 What are the worst sites?\nAir quality is known to be worst in more southern areas, places where home heating via wood burning or coal is more prevalent, particularly during the colder months of the year.\nBut let‚Äôs check some of these assumptions by extracting the worst 5 sites for highest recorded PM10 values (Table¬†1).\n\n\nShow the code\ndat |&gt; \n  filter(indicator == \"PM10\") |&gt; # just look at PM10\n  group_by(site_name) |&gt; \n  summarize(max_concentration = max(concentration, na.rm = TRUE)) |&gt; # get max conc. per site\n  arrange(desc(max_concentration)) |&gt; # sort descending\n  top_n(5, max_concentration) |&gt; # get top 5 sites\n  knitr::kable()\n\n\n\n\nTable¬†1: Top 5 sites with highest PM10 concentrations\n\n\n\n\n\n\nsite_name\nmax_concentration\n\n\n\n\nMilton\n202.800\n\n\nArrowtown\n157.900\n\n\nLower Hutt (Phil Evans Reserve)\n155.400\n\n\nInvercargill at Pomona Street\n138.980\n\n\nWashdyke Alpine\n123.496\n\n\n\n\n\n\n\n\nIndeed most of these locations are in South Island, with the exception of Lower Hutt, which is at the southern end of the North Island.\n\n\nShow the code\nprocessed_data &lt;- dat %&gt;% \n  filter(indicator == \"PM10\") %&gt;% # just look at PM10\n  group_by(site_name) %&gt;% \n  summarise(\n    max_concentration = max(concentration, na.rm = TRUE), \n    latitude = first(latitude),\n    longitude = first(longitude)\n  ) %&gt;% # get max conc. per site\n  arrange(desc(max_concentration)) %&gt;% # sort descending\n  top_n(5, max_concentration) %&gt;% \n  sf::st_as_sf(coords = c(\"longitude\", \"latitude\"), crs = 4326)\n\n# Create a color palette\npal &lt;- colorNumeric(\n  palette = \"YlOrRd\",\n  domain = processed_data$max_concentration, # Set the domain to the range of max_concentration\n  na.color = \"transparent\",\n  reverse = TRUE\n)\n\n# Create a Leaflet map\nleaflet(processed_data) %&gt;%\n  addTiles() %&gt;%\n  addCircleMarkers(\n    radius = ~sqrt(max_concentration), # Scale the radius proportional to max_concentration\n    color = ~pal(max_concentration),\n    fillOpacity = 1,\n    stroke = 0,\n    label = ~paste0(site_name, \", \", \"Max PM10: \", max_concentration)\n  ) %&gt;%\n  addLegend(\n    \"bottomright\",\n    pal = pal,\n    values = processed_data$max_concentration, # Pass the actual max_concentration values\n    title = \"Max PM10 Concentration\",\n    opacity = 0.7,\n    labFormat = labelFormat(transform = function(x) sort(x, decreasing = TRUE))\n  )"
  },
  {
    "objectID": "posts/arrowtown-air-quality/index.html#static-plot-of-seasonal-air-quality",
    "href": "posts/arrowtown-air-quality/index.html#static-plot-of-seasonal-air-quality",
    "title": "Arrowtown air quality",
    "section": "4 Static plot of seasonal air quality",
    "text": "4 Static plot of seasonal air quality\nNow let‚Äôs check the assumption that air quality is worse during the colder months of the year. Here, I plot daily PM10 concentrations over 2022 for one site (Arrowtown) (Figure¬†1). The data shows a significant spike during the winter months, with a number of exceedances of the WHO guideline of 45 ¬µg/m¬≥.\n\n\nShow the code\ndat_filtered &lt;- dat |&gt; \n  filter(site_name == \"Arrowtown\") |&gt; \n  filter(indicator == \"PM10\") |&gt; \n  filter(year == 2022) |&gt;\n  arrange(sample_date) |&gt; \n  mutate(sample_date = as.Date(sample_date))\n\n# Calculate the breaks for y-axis labels\nn_breaks &lt;- 5\nmy_breaks &lt;- scales::breaks_extended(n = n_breaks)(range(dat_filtered$concentration))\nmy_breaks &lt;- my_breaks[my_breaks &gt; 0]\n\n# Create a data frame for the tick marks\ntick_data &lt;- data.frame(\n  x = as.Date(\"2022-01-01\"),\n  xend = as.Date(\"2022-01-03\"),\n  y = my_breaks,\n  yend = my_breaks\n)\n\n# plot\nggplot(dat_filtered) +\n  geom_hline(yintercept = 45, linetype = \"dashed\", color = \"red\", alpha = 0.7) +\n  geom_line(aes(x = sample_date, y = concentration),\n            color = \"#D72638\",\n            size = 0.5) +\n  scale_x_date(date_labels = \"%b\", date_breaks = \"1 month\") +\n  labs(\n    title = bquote(\"Daily PM\"[10] * \" concentration (¬µg/m\"^3 * \") in Arrowtown, 2022\"),\n    x = \"\",\n    y = bquote(\"Daily PM\"[10] * \" concentration (¬µg/m\"^3 * \")\")\n  ) +\n  theme_minimal() +\n  theme(\n    plot.title = element_text(hjust = 0.5, \n                              colour = \"#420039\"),\n    axis.text.y = element_blank(),\n    axis.ticks.y = element_blank(),\n    axis.text.x = element_text(\n      color = \"#12355B\",\n      face = \"bold\",\n      size = 14,\n      vjust = -0.5\n    )\n  ) +\n  annotate(\n    'text',\n    x = as.Date(\"2022-01-03\"),\n    y = my_breaks,\n    label = round(my_breaks, 2),\n    angle = 0,\n    hjust = -0.1,\n    vjust = 0.5\n  ) +\n  geom_segment(data = tick_data,\n               aes(\n                 x = x,\n                 xend = xend,\n                 y = y,\n                 yend = yend\n               ),\n               color = \"black\")\n\n\n\n\n\n\n\n\nFigure¬†1: PM10 daily concentrations at Arrowtown, 2022. Dashed line shows WHO guideline value."
  },
  {
    "objectID": "posts/arrowtown-air-quality/index.html#make-an-animated-plot",
    "href": "posts/arrowtown-air-quality/index.html#make-an-animated-plot",
    "title": "Arrowtown air quality",
    "section": "5 Make an animated plot",
    "text": "5 Make an animated plot\nLet‚Äôs enhance our analysis by creating an animated polar chart that reveals the daily PM10 concentrations over time (Figure¬†2). This approach effectively highlights the cyclical nature of seasonal air quality. By animating the data, we can observe the progression of PM10 levels throughout the year, providing a clear visual representation of how air quality deteriorates during the winter months.\n\n\nShow the code\n# Define the start dates for each season according to New Zealand definitions\nseason_start_dates &lt;- as.Date(c(\"2022-12-01\", \"2022-03-01\", \"2022-06-01\", \"2022-09-01\"))\n\n# Create the plot with seasonal division lines and y-axis labels inside the chart\np &lt;- ggplot(dat_filtered) +\n  geom_hline(yintercept = 45, linetype = \"dashed\", color = \"red\", alpha = 0.7) +\n  geom_line(aes(x = sample_date, y = concentration),\n            color = \"#D72638\",\n            size = 0.5) +\n  geom_vline(\n    xintercept = as.numeric(season_start_dates),\n    linetype = \"dashed\",\n    color = \"black\",\n    alpha = 0.3\n  ) +\n  geom_point(aes(x = sample_date, y = concentration), color = \"#420039\", size = 2) +\n  scale_x_date(date_labels = \"%b\", date_breaks = \"1 month\") +\n  coord_curvedpolar() +\n  labs(\n    title = bquote(\"Daily PM\"[10] * \" concentration (¬µg/m\"^3 * \") in Arrowtown, 2022\"),\n    x = \"\",\n    y = \"\"\n  ) +\n  theme_minimal() +\n  theme(\n    plot.title = element_text(hjust = 0.5, \n                              colour = \"#420039\"),\n    axis.text.y = element_blank(),\n    axis.ticks.y = element_blank(),\n    axis.text.x = element_text(\n      color = \"#12355B\",\n      face = \"bold\",\n      size = 14,\n      vjust = -0.5\n    )\n  ) +\n  annotate(\n    'text',\n    x = as.Date(\"2022-01-03\"),\n    y = my_breaks,\n    label = round(my_breaks, 2),\n    angle = 0,\n    hjust = -0.1,\n    vjust = 0.5\n  ) +\n  geom_segment(data = tick_data,\n               aes(\n                 x = x,\n                 xend = xend,\n                 y = y,\n                 yend = yend\n               ),\n               color = \"black\") +\n  transition_reveal(sample_date) +\n  ease_aes('linear')  # Easing to make the animation smoother\n\n# Render the animation and save as GIF\nanim &lt;- animate(p, nframes = 100, fps = 10, renderer = gifski_renderer())\n\nanim\n\n\n\n\n\n\n\n\nFigure¬†2: Animated polar chart of PM10 daily concentrations at Arrowtown, 2022. Dashed circle shows WHO guideline value. Dashed lines show seasons."
  },
  {
    "objectID": "posts/arrowtown-air-quality/index.html#make-multiple-animated-plots",
    "href": "posts/arrowtown-air-quality/index.html#make-multiple-animated-plots",
    "title": "Arrowtown air quality",
    "section": "6 Make multiple animated plots",
    "text": "6 Make multiple animated plots\nNow let‚Äôs check out whether other high PM10 sites also have similar seasonal dynamics in air quality (we‚Äôll also use a different year to make sure) (Figure¬†3).\n\n\nShow the code\ntop_4 &lt;- dat |&gt; \n  filter(indicator == \"PM10\") |&gt; # just look at PM10\n  group_by(site_name) |&gt; \n  summarize(max_concentration = max(concentration, na.rm = TRUE)) |&gt; # get max conc. per site\n  arrange(desc(max_concentration)) |&gt; # sort descending\n  top_n(4, max_concentration)\n\np2 &lt;- dat |&gt; \n  filter(site_name %in% top_4$site_name) |&gt; \n  filter(indicator == \"PM10\") |&gt; \n  filter(year == 2019) |&gt;\n  arrange(sample_date) |&gt; \n  mutate(sample_date = as.Date(sample_date)) |&gt; \n  ggplot() +\n    geom_hline(yintercept = 45, linetype = \"dashed\", color = \"red\", alpha = 0.7) +\n    geom_line(aes(x = sample_date, y = concentration), color = \"#D72638\", size = 0.5) +\n    geom_point(aes(x = sample_date, y = concentration), color = \"#420039\", size = 2) +\n    scale_x_date(date_labels = \"%b\", date_breaks = \"1 month\") +\n    coord_curvedpolar() +\n    theme_minimal() +\n    labs(x = \"\", \n         y = bquote(\"Daily PM\"[10] * \" concentration (¬µg/m\"^3 * \")\")) +\n    transition_reveal(sample_date) +\n    ease_aes('linear') +\n    facet_wrap(~site_name, scales = \"free_y\")\n\n# Render the animation and save as GIF\nanim2 &lt;- animate(p2, nframes = 100, fps = 10, renderer = gifski_renderer())\n\nanim2\n\n\n\n\n\n\n\n\nFigure¬†3: Animated polar chart of PM10 daily concentrations at Arrowtown, Invercargill, Lower Hutt, and Milton, 2019. Dashed circle shows WHO guideline value. Note the y-axes differ between plots.\n\n\n\n\n\nSome interesting results here.1 Firstly, Arrowtown demonstrates similar seasonal dynamics to 2022, with low concentrations in summer and a number of exceedances during winter. Invercargill also shows similar seasonality, albeit at lower concentrations.\nLower Hutt remains well below the guideline all year-round, but exhibits reversed seasonality, with higher concentrations in summer. It‚Äôs worth noting that Lower Hutt is included in the top four due to a single large spike in 2022, so it might be reasonable to exclude this site from further analysis.\nMilton is particularly interesting as it has numerous exceedances during winter but appears not to monitor air quality during summer (this trend is true in other years as well)."
  },
  {
    "objectID": "posts/arrowtown-air-quality/index.html#next-steps",
    "href": "posts/arrowtown-air-quality/index.html#next-steps",
    "title": "Arrowtown air quality",
    "section": "7 Next steps",
    "text": "7 Next steps\nThis analysis has provided some interesting insights into the seasonality of PM10 concentrations in New Zealand. The next steps could involve:\n\nConduct a formal test for seasonality between sites\nClassify sites into categories such as ‚Äòhigh-summer‚Äô, ‚Äòhigh-winter‚Äô, ‚Äòhigh-all-year-round‚Äô, or ‚Äòlow‚Äô\nProduce animations for all sites on a map\nInvestigate causes of seasonality (latitude?)\nRepeat analyses for PM2.5\nPut multiple years on single graph"
  },
  {
    "objectID": "posts/arrowtown-air-quality/index.html#footnotes",
    "href": "posts/arrowtown-air-quality/index.html#footnotes",
    "title": "Arrowtown air quality",
    "section": "Footnotes",
    "text": "Footnotes\n\n\nNote the y-axes differ between each site. This is due to the large magnitude in differences. My goal here was to explore the relative seasonality between each site, so having free axes makes sense. If the goal was instead to explore relative magnitudes between each site, I could have simply set facet_wrap(~site_name, scales = \"fixed\").‚Ü©Ô∏é"
  },
  {
    "objectID": "posts/koordinatr/index.html",
    "href": "posts/koordinatr/index.html",
    "title": "Koordinates API for R",
    "section": "",
    "text": "Many government agencies1 in New Zealand provide spatial and tabular data through data services built on the fantastic Koordinates platform. The challenge arises when trying to import this data into R, as it involves several steps:\n\nAdd the dataset to your cart\nCreate an export\nWait for file to finish processing\nDownload the file to your computer\nOpen R\nNavigate to the file path of the downloaded folder (e.g., in read_csv() or read_sf())\nFinally, read the file into R.\n\nBy utilising an API, we can bypass many of these steps and read a dataset directly into R. Additionally, using an API provides the benefit of accessing the most up-to-date data, facilitating collaboration, and using version control without the need to share data files."
  },
  {
    "objectID": "posts/koordinatr/index.html#the-problem",
    "href": "posts/koordinatr/index.html#the-problem",
    "title": "Koordinates API for R",
    "section": "",
    "text": "Many government agencies1 in New Zealand provide spatial and tabular data through data services built on the fantastic Koordinates platform. The challenge arises when trying to import this data into R, as it involves several steps:\n\nAdd the dataset to your cart\nCreate an export\nWait for file to finish processing\nDownload the file to your computer\nOpen R\nNavigate to the file path of the downloaded folder (e.g., in read_csv() or read_sf())\nFinally, read the file into R.\n\nBy utilising an API, we can bypass many of these steps and read a dataset directly into R. Additionally, using an API provides the benefit of accessing the most up-to-date data, facilitating collaboration, and using version control without the need to share data files."
  },
  {
    "objectID": "posts/koordinatr/index.html#koordinatr",
    "href": "posts/koordinatr/index.html#koordinatr",
    "title": "Koordinates API for R",
    "section": "2 Koordinatr",
    "text": "2 Koordinatr\nI have developed a package that simplifies this process. It only works for tabular and vector spatial data for now (a function for rasters has not been implemented yet). However, it has been a time-saver for me in my work with these data.\n\n\n\n\n\n\nWarning\n\n\n\nNote: This package is still experimental, and changes may occur in the future. The arguments might change, or the whole thing might break. Use at your own risk.\n\n\n\n2.1 Setup\n\n2.1.1 Installation\nThe package is not yet available on CRAN, so it can be installed from GitHub:\n# install.packages(\"devtools\")\ndevtools::install_github(\"isaacbain/koordinatr\")\n\n\n2.1.2 Authentication\nYou will need an API key to access the data. This can be obtained by signing up on the Koordinates platform and creating a new API key.\napi_key &lt;- \"your_api_key\"\n\n\n\n2.2 Usage\nThe package has two primary functions: get_table_as_tibble() and get_table_as_sf(). The former is for tabular data, while the latter is for spatial data.\nBoth functions share the same arguments:\n\napi_key - Your Koordinates API key.\nagency - The agency providing the data. Should be one of ‚Äúlinz‚Äù, ‚Äústatsnz‚Äù, ‚Äúmfe‚Äù. Or ‚Äúcustom‚Äù if you want to manually specify the URL for the service.\nid - The ID of the dataset you want to access.\ncustom_url - If you set agency = \"custom\", you can specify the URL of the service here."
  },
  {
    "objectID": "posts/koordinatr/index.html#example",
    "href": "posts/koordinatr/index.html#example",
    "title": "Koordinates API for R",
    "section": "3 Example",
    "text": "3 Example\nLet‚Äôs demonstrate its use by fetching a table of greenhouse gas concentrations from the Baring Head Atmospheric Research Station, from the Ministry for the Environment data service. Using the Koordinatr package, we can directly read this data into R without manual downloading.\n\n# libraries\nlibrary(koordinatr)\nlibrary(tidyverse)\nlibrary(gganimate)\n\n# import data\nall_gases_raw &lt;- get_table_as_tibble(\n  api_key = api_key, # set your own api key\n  agency = \"mfe\", # set the agency\n  id = \"115974\" # get the ID from the URL of the dataset\n)\n\nIt was as easy as that! (hopefully).\nNow, let‚Äôs create a basic plot (Figure¬†1) using this data to check it has worked properly.\n\n# filtering\nco2 &lt;- all_gases_raw |&gt;\n  select(-gml_id) |&gt; # don't need this column\n  filter(parameter == \"trend\", variable == \"carbon_dioxide\") |&gt; # can select raw data points, seasonally adjusted, or the trend\n  mutate(date = make_date(year = year, month = month, day = 1)) # turn columns into a proper date\n\nall_gases &lt;- all_gases_raw |&gt;\n  select(-gml_id) |&gt;\n  filter(parameter == \"mean_fitted\") |&gt;\n  mutate(date = make_date(year = year, month = month, day = 1))\n\nggplot(data = all_gases, aes(x = date, y = value)) +\n  geom_point(size = 0.01) +\n  geom_smooth(method = \"lm\") +\n  facet_wrap(~variable, scales = \"free_y\") +\n  theme_minimal() +\n  labs(\n    x = \"Date\",\n    y = \"Concentration (ppm)\",\n    title = \"Greenhouse gas concentrations\",\n    subtitle = \"Baring Head, 1972‚Äî2022\"\n  )\n\n\n\n\n\n\n\nFigure¬†1: Concentration of carbon dioxide, methane, and nitrous oxide gases at Baring Head. Starting at 1972, 1990, and 1996, respectively.\n\n\n\n\n\nAnd how about an animated plot?\n\n\nShow the code\n# Define the exact breaks for the x-axis\nbreaks &lt;- seq.Date(from = as.Date(\"1970-01-01\"), to = as.Date(\"2022-01-01\"), by = \"5 years\")\n\n# Custom labelling function\nppm_label &lt;- function(x) {\n  paste0(x, \" ppm\")\n}\n\np &lt;- ggplot(co2, aes(x = date, y = value, colour = value)) +\n  geom_line(linewidth = 0.75) +\n  geom_point(aes(colour = value), size = 2) +\n  scale_colour_gradient(low = \"#1f78b4\", high = \"#e31a1c\") +\n  transition_reveal(date) +\n  expand_limits(y = c(325, 425)) +\n  theme_minimal() +\n  scale_y_continuous(labels = ppm_label) +\n  labs(\n    x = \"\",\n    y = bquote(CO[2]),\n    title = \"Carbon dioxide concentration at Baring Head, 1972‚Äì2022\",\n    subtitle = \"Date: {frame_along}\"\n  ) +\n  theme(\n    legend.position = \"none\",\n    plot.margin = margin(t = 10, r = 10, b = 30, l = 10),\n    panel.grid.major = element_blank(), # Remove major gridlines\n    panel.grid.minor = element_blank(), # Remove minor gridlines\n    plot.title = element_text(size = 15, face = \"bold\", colour = \"darkslateblue\"),\n    plot.subtitle = element_text(size = 10)\n  ) +\n  geom_text(aes(label = round(value, 0), y = value), hjust = 0.5, vjust = -1, size = 5) +\n  view_follow(fixed_y = TRUE) +\n  scale_x_date(breaks = breaks, date_labels = \"%Y\", limits = range(co2$date))\n\nanimate(p,\n  nframes = 400,\n  fps = 30,\n  start_pause = 0,\n  end_pause = 60\n)\n\n\n\n\n\n\n\n\nFigure¬†2: Animated plot of carbon dioxide concentrations at Baring Head, 1972‚Äî2022."
  },
  {
    "objectID": "posts/koordinatr/index.html#conclusion",
    "href": "posts/koordinatr/index.html#conclusion",
    "title": "Koordinates API for R",
    "section": "4 Conclusion",
    "text": "4 Conclusion\nAnd that‚Äôs it! You‚Äôve now got a basic understanding of how to use the Koordinatr package to access data from the Koordinates API. These data services are a treasure trove of environmental information, so I encourage you to explore them and discover what could be applicable to your own work."
  },
  {
    "objectID": "posts/koordinatr/index.html#footnotes",
    "href": "posts/koordinatr/index.html#footnotes",
    "title": "Koordinates API for R",
    "section": "Footnotes",
    "text": "Footnotes\n\n\nMinistry for the Environment data service. Statistics New Zealand geographic data service. Land Information New Zealand data service. Manaaki Whenua Landcare Research LRIS portal. Civil Deference NationalMap data service. Kapiti Coast District Council GIS Open Data. Scion Research data service. Resilience National Science Challenge NZ Coastlines data service. Waikato District Council data service.‚Ü©Ô∏é"
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "Hi there! I‚Äôm a quantitative ecologist who loves working in environmental resource management. I dive into all sorts of tasks, from analysing raw data and generating insights, to developing policies, advising decision-makers, and building tools to help with implementation. I‚Äôm all about using open-source tools like R and making sure my analyses are reproducible.\nI call ≈åtautahi (Christchurch) home‚Äîa lovely little city. When I‚Äôm not working, you‚Äôll likely find me packrafting, paragliding, bikepacking, or sea kayaking.\nMost of my work focuses on freshwater ecosystems, but I‚Äôm also interested in how environmental health affects human health. I spend a lot of time at the intersection of science and policy, trying to bridge the gap between research and real-world applications.\nOn top of all that, I‚Äôm also a PhD candidate in Public Health at the University of Otago, continuing to learn and contribute to a new field."
  }
]
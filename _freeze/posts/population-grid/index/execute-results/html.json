{
  "hash": "cf10e2bc7b2ff3e6d6785f6356d2be8a",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Exploring the Estimated Resident Population Grid\"\nauthor: \"Isaac Bain\"\ndate: \"2024-06-25\"\ncategories: [code, population, maps]\nexecute:\n  warning: false\n  error: false\n  messages: false\nformat: \n  html:\n    code-fold: true\n    code-summary: \"Show the code\"\n    toc: true\n    toc-location: left\n    number-sections: true\neditor: visual\nlightbox: auto\ndraft: true\nknitr:\n  opts_chunk: \n    dev: \"ragg_png\"\n---\n\n\n## Overview\n\nUnderstanding the distribution of populations is crucial for various applications, from urban planning to environmental management. Statistics New Zealandâ€™s recently released 2022 Estimated Resident Population Grid at a 500-metre resolution provides an invaluable resource for researchers, policymakers, and analysts.\n\nThis dataset stands out due to its fine resolution. Previously, population information was available at the Statistical Area 1 (SA1) level, with SA1s typically housing between 100-200 residents, and a maximum population of about 500. SA1s vary in size, being smaller in urban areas and larger in rural ones.\n\nNow, the population grid offers a much finer resolution, available at 250 metre[^1], 500 metre[^2], or 1000 metre[^3] sizes. To create these population grids, Stats NZ disaggregated population counts from larger geographic areas (i.e., meshblocks) into smaller regular grid cells. This was done using a combination of spatial interpolation methods and ancillary data, such as land use and residential building locations, to accurately distribute the population estimates across the grid.\n\n[^1]: <https://datafinder.stats.govt.nz/layer/115047-new-zealand-2022-estimated-resident-population-grid-250-metre-2023/>\n\n[^2]: <https://datafinder.stats.govt.nz/layer/115050-new-zealand-2022-estimated-resident-population-grid-500-metre-2023/>\n\n[^3]: <https://datafinder.stats.govt.nz/layer/115051-new-zealand-2022-estimated-resident-population-grid-1-kilometre-2023/>\n\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Libraries code\"}\nlibrary(tidyverse)\nlibrary(sf)\nlibrary(koordinatr)\nlibrary(ggdark)\nlibrary(ggfx)\nlibrary(ggtext)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-summary=\"Import data code\"}\n# 500m \ndat <- koordinatr::get_layer_as_sf(api_key = Sys.getenv(\"koordinates_api_key\"),\n                                  agency = \"statsnz\",\n                                  id = \"115050\")\n\ncoastline <- st_read(\"data/coastline_simplified/nz-coastlines-and-islands-polygons-topo-150k.shp\", crs = 2193)\n```\n:::\n\n## Inspiration\n\nI wanted to create something that resembled a satellite image or a photo from the International Space Station looking down on New Zealand at night, with the lights of all the different cities shining back *(ignoring the fact this is also known as light pollution!)*.\n\nHere's two examples:\n\n::: {layout-ncol=\"2\"}\n![](new_zealand_DNB_Oct.png)\n\n![](nzherald.png)\n:::\n\n## Creating the plot\n\nThe data were provided in a rectangular regular grid, with counts of the Estimated Resident Population per grid cell. To address the wide range of values and maintain aesthetic appeal, a log-transform of the counts was applied. The legend was back-transformed to improve readability.\n\nI used the `ggfx` package to add an outer glow to the coastline, and the `ggdark` package to create a dark theme for the plot. The colour scale was from the `viridis` palette, which is a perceptually uniform colour scale that is designed to be colour blind-friendly.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  with_outer_glow(\n    geom_sf(data = coastline, fill = \"black\", colour = NA),\n    colour = \"#262525\",\n    sigma = 60, \n    expand = 30\n  ) +\n  geom_sf(data = dat, aes(fill = log(ERP_2022)), colour = NA) +\n  scale_fill_viridis_c(\n    option = \"plasma\",\n    breaks = log(c(1, 5, 20, 100, 500)), # Adjust breaks for normal scale\n    labels = c(\"1\", \"5\", \"20\", \"100\", \"500\"), # Corresponding labels\n    guide = guide_colourbar(title.position = \"top\", title.hjust = 0.5, direction = \"horizontal\")\n  ) +\n  coord_sf(xlim = c(1050000, 2200000), ylim = c(4700000, 6200000)) +\n  ggdark::dark_theme_void(base_size = 14) +\n  theme(\n    legend.position = \"inside\",\n    legend.position.inside = c(0.75, 0.2),\n    legend.key.width = unit(1.25, \"cm\"),\n    legend.title = element_text(size = rel(0.7), hjust = 0.5, color = \"#847E89\"),\n    legend.text = element_text(color = \"#847E89\"),\n    plot.caption = element_text(color = \"#847E89\"),\n    plot.title = element_markdown(\n      family = \"Baskerville\", \n      size = rel(2.75),\n      color = \"#C2D3CD\",\n      hjust = 0.5,\n      margin = margin(14, 0, 4, 0)\n    ),\n    plot.subtitle = element_markdown(\n      family = \"Montserrat\", \n      color = \"#9FA4A9\",\n      hjust = 0.5\n    )\n  ) +\n  labs(\n    title = \"People patterns in Aotearoa\",\n    subtitle = \"Population density from StatsNZ 2023 census data\",\n    caption = \"isaacbain.com\",\n    fill = \"Estimated Resident Population\\n per 500m2\"\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=65% height=65%}\n:::\n:::\n\n\n## Conclusion\n\nI had a lot of fun making this population density map in a dark theme. The resulting visualisation not only highlights population patterns but also provides a visually striking representation of New Zealand's demographic landscape.\n\nThe improvement in spatial resolution offered by this data could significantly enhance research applications. For instance, it enables more accurate distribution of populations onto river networks, allowing us to answer questions such as how many people live upstream of any given river segment. *Stay tuned for a future post on this topic.*\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}